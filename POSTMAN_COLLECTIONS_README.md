# Postman Collections для Investment Trading Service

## Обзор

Этот документ описывает Postman коллекции для тестирования Investment Trading Service API. Коллекции включают все доступные эндпоинты с примерами запросов и автоматизированными тестами.

## Доступные файлы

### 1. Investment-Trading-Service.postman_collection.json
**Основная коллекция** с всеми эндпоинтами сервиса.

### 2. Investment-Trading-Service-Test.postman_environment.json
**Переменные окружения** для тестовой среды.

### 3. Investment-Trading-Service-Examples.postman_collection.json
**Коллекция с примерами** и автоматизированными тестами.

## Доступные эндпоинты

| Метод | Путь | Описание | Детали |
|-------|------|----------|--------|
| POST  | `/api/cache/warm` | Прогрев кэша | Загружает данные из БД в кэш |
| POST  | `/api/cache/clear` | Очистка кэша | Очищает все кэши |
| GET   | `/api/cache/instruments` | Получение всех инструментов | Получает акции, фьючерсы и индикативы только из кэша |
| GET   | `/api/cache/shares` | Получение акций только из кэша | Получает акции исключительно из кэша |
| GET   | `/api/cache/futures` | Получение фьючерсов только из кэша | Получает фьючерсы исключительно из кэша |
| GET   | `/api/cache/indicatives` | Получение индикативов только из кэша | Получает индикативы исключительно из кэша |
| GET   | `/api/cache/statistics` | Получение статистики кэша | Получает детальную статистику всех кэшей |
| GET   | `/api/cache/main-prices` | Получение основных цен | Заглушка для будущей реализации |
| GET   | `/api/cache/evening-prices` | Получение вечерних цен | Заглушка для будущей реализации |
| GET   | `/api/cache/open-prices` | Получение утренних цен | Заглушка для будущей реализации |
| GET   | `/api/cache/divedends` | Получение дивидендов | Заглушка для будущей реализации |
| GET   | `/api/cache/by-figi/{figi}` | Получение по FIGI | Заглушка для будущей реализации |

## Переменные окружения

### Test Environment
- **base_url**: `http://localhost:8080` - Базовый URL сервиса
- **cache_warm_endpoint**: `/api/cache/warm` - Эндпоинт прогрева кэша
- **cache_clear_endpoint**: `/api/cache/clear` - Эндпоинт очистки кэша
- **cache_statistics_endpoint**: `/api/cache/statistics` - Эндпоинт статистики кэша
- **cache_shares_endpoint**: `/api/cache/shares` - Эндпоинт получения акций
- **cache_futures_endpoint**: `/api/cache/futures` - Эндпоинт получения фьючерсов
- **cache_indicatives_endpoint**: `/api/cache/indicatives` - Эндпоинт получения индикативов
- **instruments_endpoint**: `/api/cache/instruments` - Эндпоинт получения всех инструментов

## Примеры использования

### 1. Прогрев кэша
```bash
curl -X POST "http://localhost:8080/api/cache/warm"
```

### 2. Получение всех инструментов
```bash
curl -X GET "http://localhost:8080/api/cache/instruments"
```

### 3. Получение только акций
```bash
curl -X GET "http://localhost:8080/api/cache/shares"
```

### 4. Получение только фьючерсов
```bash
curl -X GET "http://localhost:8080/api/cache/futures"
```

### 5. Получение только индикативов
```bash
curl -X GET "http://localhost:8080/api/cache/indicatives"
```

### 6. Получение статистики кэша
```bash
curl -X GET "http://localhost:8080/api/cache/statistics"
```

### 7. Очистка кэша
```bash
curl -X POST "http://localhost:8080/api/cache/clear"
```

## Структура ответов

### Успешный ответ
```json
{
  "success": true,
  "status": "success",
  "message": "Описание операции",
  "data": {...},
  "timestamp": "2024-01-15T12:00:00"
}
```

### Ответ с ошибкой
```json
{
  "success": false,
  "status": "error",
  "message": "Описание ошибки",
  "error": "ExceptionClass",
  "timestamp": "2024-01-15T12:00:00"
}
```

## Особенности новых методов "только из кэша"

### Преимущества
- **Быстрый отклик**: Данные берутся только из памяти
- **Нет нагрузки на БД**: Отсутствуют запросы к PostgreSQL
- **Предсказуемое поведение**: Если кэш пуст, возвращается пустой список

### Поведение при пустом кэше
```json
{
  "success": true,
  "status": "success",
  "message": "Инструменты успешно получены из кэша",
  "shares_size": 0,
  "futures_size": 0,
  "indicatives_size": 0,
  "total_instruments": 0,
  "shares": [],
  "futures": [],
  "indicatives": [],
  "timestamp": "2024-01-15T12:00:00"
}
```

## Автоматизированные тесты

Коллекция `Investment-Trading-Service-Examples.postman_collection.json` включает:

### 1. Тесты статуса ответа
- Проверка HTTP статуса (200, 500)
- Проверка структуры JSON

### 2. Тесты производительности
- Время отклика < 1000ms
- Время отклика < 500ms для кэшированных данных

### 3. Тесты содержимого
- Наличие обязательных полей
- Корректность типов данных
- Проверка количества инструментов

### 4. Тесты кэша
- Проверка заполненности кэша
- Проверка статистики кэша
- Тестирование операций прогрева и очистки

## Рекомендации по использованию

### 1. Последовательность тестирования
1. **Прогрев кэша**: `POST /api/cache/warm`
2. **Проверка заполненности**: `GET /api/cache/instruments`
3. **Получение статистики**: `GET /api/cache/statistics`
4. **Тестирование отдельных типов**: `GET /api/cache/shares`, `/futures`, `/indicatives`
5. **Очистка кэша**: `POST /api/cache/clear`

### 2. Мониторинг производительности
- Используйте тесты времени отклика
- Отслеживайте статистику кэша
- Проверяйте заполненность кэша

### 3. Отладка проблем
- Проверяйте логи сервиса
- Используйте статистику кэша для диагностики
- Тестируйте с пустым и заполненным кэшем

## Устранение неполадок

### Проблема: Пустой кэш
**Симптомы**: Все эндпоинты возвращают пустые списки
**Решение**: Выполните прогрев кэша `POST /api/cache/warm`

### Проблема: Медленный отклик
**Симптомы**: Время отклика > 1000ms
**Решение**: Проверьте статистику кэша и выполните прогрев

### Проблема: Ошибки 500
**Симптомы**: HTTP статус 500 в ответах
**Решение**: Проверьте логи сервиса и состояние БД

## Заключение

Postman коллекции предоставляют полный набор инструментов для тестирования Investment Trading Service API. Новые методы "только из кэша" обеспечивают высокую производительность и надежность при работе с кэшированными данными.

Используйте эти коллекции для:
- **Разработки**: Тестирование новых функций
- **Интеграции**: Проверка совместимости с внешними системами
- **Мониторинга**: Отслеживание производительности и состояния кэша
- **Отладки**: Диагностика проблем с кэшем и API