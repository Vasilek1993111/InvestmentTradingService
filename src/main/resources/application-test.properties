# ===========================================
# Test Configuration
# ===========================================

# Server Configuration
server.port=${TEST_SERVER_PORT:8089}


# ===========================================
# Database Configuration (PostgreSQL для тестов)
# ===========================================

# PostgreSQL Database (Test) - локальная БД со схемой invest
spring.datasource.url=${TEST_DATABASE_URL:jdbc:postgresql://localhost:5434/postgres?currentSchema=invest}
spring.datasource.driverClassName=org.postgresql.Driver
spring.datasource.username=${SPRING_DATASOURCE_TEST_USERNAME}
spring.datasource.password=${SPRING_DATASOURCE_TEST_PASSWORD}

# Connection Pool Settings (Test)
spring.datasource.hikari.maximum-pool-size=${TEST_DB_POOL_SIZE:5}
spring.datasource.hikari.minimum-idle=${TEST_DB_MIN_IDLE:2}
spring.datasource.hikari.connection-timeout=${TEST_DB_CONNECTION_TIMEOUT:10000}
spring.datasource.hikari.idle-timeout=${TEST_DB_IDLE_TIMEOUT:300000}
spring.datasource.hikari.max-lifetime=${TEST_DB_MAX_LIFETIME:900000}
spring.jpa.properties.hibernate.cache.use_second_level_cache=false
spring.jpa.properties.hibernate.cache.use_query_cache=false

# JPA/Hibernate Configuration
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=${TEST_JPA_SHOW_SQL:true}
spring.jpa.properties.hibernate.format_sql=${TEST_JPA_FORMAT_SQL:true}

# ===========================================
# T Invest API Configuration
# ===========================================

# T Invest API Settings
tinvest.api.token=${T_INVEST_TEST_TOKEN}
tinvest.account.id=${TINVEST_ACCOUNT_ID:2282870518}
tinvest.api.url=${TEST_TINVEST_API_URL:invest-public-api.tinkoff.ru}
tinvest.api.port=${TEST_TINVEST_API_PORT:443}
tinvest.api.sandbox=${TEST_TINVEST_API_SANDBOX:false}
tinvest.api.timeout=${TEST_TINVEST_API_TIMEOUT:10000}

# ===========================================
# Cache Configuration
# ===========================================

# Caffeine Cache Settings (Test - быстрый кэш)
spring.cache.type=caffeine
spring.cache.caffeine.spec=${TEST_CACHE_SPEC:maximumSize=100,expireAfterWrite=1m,expireAfterAccess=30s}

# Cache Names


# ===========================================
# Logging Configuration
# ===========================================

# Logging Level (Test - подробные логи)
logging.level.com.example.investmenttradingservice=${TEST_LOG_LEVEL:DEBUG}
logging.level.org.springframework.cache=${TEST_CACHE_LOG_LEVEL:DEBUG}
logging.level.io.grpc=${TEST_GRPC_LOG_LEVEL:INFO}
logging.level.ru.tinkoff.piapi=${TEST_TINVEST_LOG_LEVEL:INFO}
logging.level.org.hibernate.SQL=${TEST_SQL_LOG_LEVEL:DEBUG}
logging.level.org.springframework.test=${TEST_SPRING_LOG_LEVEL:DEBUG}

# Log Pattern
logging.pattern.console=%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ===========================================
# Actuator Configuration
# ===========================================

# Actuator Endpoints (Test - все endpoints для отладки)
management.endpoints.web.exposure.include=${TEST_ACTUATOR_ENDPOINTS:health,info,metrics,cache,env,configprops}
management.endpoint.health.show-details=${TEST_HEALTH_SHOW_DETAILS:always}
management.endpoint.cache.enabled=${TEST_CACHE_ENDPOINT_ENABLED:true}

# Health Check Configuration
management.health.cache.enabled=true
management.health.db.enabled=true

# ===========================================
# Security Configuration
# ===========================================



# ===========================================
# Validation Configuration
# ===========================================

# Validation Settings
spring.validation.enabled=true

# ===========================================
# Error Handling
# ===========================================

# Error Pages (Test - подробные ошибки)
server.error.include-message=${TEST_ERROR_INCLUDE_MESSAGE:always}
server.error.include-binding-errors=${TEST_ERROR_INCLUDE_BINDING:always}
server.error.include-stacktrace=${TEST_ERROR_INCLUDE_STACKTRACE:always}
server.error.include-exception=true


