# ===========================================
# Investment Trading Service Configuration
# ===========================================

# Server Configuration
server.port=8080


# Spring Configuration
spring.application.name=investment-trading-service
spring.profiles.active=dev

# ===========================================
# Database Configuration
# ===========================================

# PostgreSQL Database (Development) - локальная БД со схемой invest
spring.datasource.url=${DATABASE_URL:jdbc:postgresql://localhost:5434/investment_trading_dev?currentSchema=invest}
spring.datasource.driverClassName=org.postgresql.Driver
spring.datasource.username=${DATABASE_USERNAME:postgres}
spring.datasource.password=${DATABASE_PASSWORD:postgres}

# JPA/Hibernate Configuration
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=${JPA_DDL_AUTO:update}
spring.jpa.show-sql=${JPA_SHOW_SQL:true}
spring.jpa.properties.hibernate.format_sql=${JPA_FORMAT_SQL:true}
spring.jpa.properties.hibernate.cache.use_second_level_cache=false
spring.jpa.properties.hibernate.cache.use_query_cache=false

# ===========================================
# T Invest API Configuration
# ===========================================

# T Invest API Settings (PROD only)
# Expect production token via env var TINVEST_API_TOKEN (no quotes/newlines)
tinvest.api.token=${TINVEST_API_TOKEN}
tinvest.api.url=${TINVEST_API_URL:2234001642}
tinvest.api.port=${TINVEST_API_PORT:443}
tinvest.api.sandbox=${TINVEST_API_SANDBOX:true}
tinvest.api.timeout=${TINVEST_API_TIMEOUT:30000}
tinvest.account.id=${TINVEST_ACCOUNT_ID:T_INVEST_ACCOUNT_ID}

# ===========================================
# Cache Configuration
# ===========================================

# Caffeine Cache Settings
spring.cache.type=caffeine
spring.cache.caffeine.spec=maximumSize=1000,expireAfterWrite=10m,expireAfterAccess=5m

# Cache Names
cache.names.trading-operations=trading-operations
cache.names.portfolio-data=portfolio-data
cache.names.asset-prices=asset-prices
cache.names.shares-reference=shares-reference
cache.names.futures-reference=futures-reference

# ===========================================
# Async Processing Configuration
# ===========================================

# Thread Pool Configuration for Order Processing
app.async.core-pool-size=${ASYNC_CORE_POOL_SIZE:#{T(Runtime).getRuntime().availableProcessors() * 2}}
app.async.max-pool-size=${ASYNC_MAX_POOL_SIZE:#{T(Runtime).getRuntime().availableProcessors() * 4}}
app.async.queue-capacity=${ASYNC_QUEUE_CAPACITY:1000}
app.async.keep-alive-seconds=${ASYNC_KEEP_ALIVE:60}

# Rate Limiting Configuration
app.rate-limit.min-interval-ms=${RATE_LIMIT_MIN_INTERVAL:100}
app.rate-limit.max-requests-per-second=${RATE_LIMIT_MAX_RPS:10}

# Retry Configuration
app.retry.max-attempts=${RETRY_MAX_ATTEMPTS:3}
app.retry.base-delay-ms=${RETRY_BASE_DELAY:100}
app.retry.max-delay-ms=${RETRY_MAX_DELAY:5000}

# ===========================================
# Logging Configuration
# ===========================================

# Logging Level
logging.level.com.example.investmenttradingservice=INFO
logging.level.org.springframework.cache=DEBUG
logging.level.io.grpc=INFO
logging.level.ru.tinkoff.piapi=INFO

# Log Pattern
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ===========================================
# Actuator Configuration
# ===========================================

# Actuator Endpoints
management.endpoints.web.exposure.include=health,info,metrics,cache
management.endpoint.health.show-details=when-authorized
management.endpoint.caches.enabled=true

# Health Check Configuration
# Cache health check is automatically enabled
management.health.db.enabled=true

# ===========================================
# Security Configuration
# ===========================================

# Basic Security (пароли из .env файлов)
spring.security.user.name=${ADMIN_USERNAME:admin}
spring.security.user.password=${ADMIN_PASSWORD}
spring.security.user.roles=${ADMIN_ROLES:ADMIN}

# ===========================================
# Jackson Configuration
# ===========================================

# JSON Serialization
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.deserialization.fail-on-unknown-properties=false
spring.jackson.default-property-inclusion=NON_NULL

# ===========================================
# Validation Configuration
# ===========================================

# Validation Settings (automatically enabled with spring-boot-starter-validation)

# ===========================================
# Development Tools
# ===========================================

# DevTools Configuration
spring.devtools.restart.enabled=true
spring.devtools.livereload.enabled=true
spring.devtools.restart.exclude=static/**,public/**

# ===========================================
# Error Handling
# ===========================================

# Error Pages
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=on_param
server.error.include-exception=false

# ===========================================
# Timezone Configuration
# ===========================================

# Default Timezone
spring.jackson.time-zone=Europe/Moscow
